if("undefined"==typeof jQuery)throw new Error("multiselect requires jQuery");!function(t){"use strict";var e=t.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<7)throw new Error("multiselect crequires jQuery version 1.7 or higher")}(jQuery),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){"use strict";var e=function(t){function e(e,l){var i=e.data(),o=[];for(var n in i)if(i.hasOwnProperty(n)){var r=n.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()});o[r]*=i[n]}t.extend(l,i);var c=e.prop("id");this.id=c,this.$left=e,this.$right=t(t(l.right).length?l.right:"#"+c+"_to"),this.left=this.$left.get(0),this.right=this.$right.get(0),this.actions={$leftAll:t(t(l.leftAll).length?l.leftAll:"#"+c+"_leftAll"),$rightAll:t(t(l.rightAll).length?l.rightAll:"#"+c+"_rightAll"),$leftSelected:t(t(l.leftSelected).length?l.leftSelected:"#"+c+"_leftSelected"),$rightSelected:t(t(l.rightSelected).length?l.rightSelected:"#"+c+"_rightSelected")},delete l.leftAll,delete l.leftSelected,delete l.right,delete l.rightAll,delete l.rightSelected,this.options={keepRenderingSort:l.keepRenderingSort,submitAllLeft:void 0!==l.submitAllLeft?l.submitAllLeft:!0,submitAllRight:void 0!==l.submitAllRight?l.submitAllRight:!0,leftSearch:l.leftSearch,rightSearch:l.rightSearch,leftBulk:l.leftBulk},delete l.keepRenderingSort,l.submitAllLeft,l.submitAllRight,l.search,this.callbacks=l,this.init()}return e.prototype={init:function(){var e=this;e.options.keepRenderingSort&&(e.skipInitSort=!0,e.callbacks.sort=function(e,l){return t(e).data("position")>t(l).data("position")?1:-1},e.$left.find("option").each(function(e,l){t(l).data("position",e)}),e.$right.find("option").each(function(e,l){t(l).data("position",e)})),"function"==typeof e.callbacks.startUp&&e.callbacks.startUp(e.$left,e.$right),e.skipInitSort||"function"!=typeof e.callbacks.sort||e.$left.mSort(e.callbacks.sort),e.options.leftSearch?e.options.$leftSearch=t(e.options.leftSearch):t("#"+e.id+"_leftSearch").length>0&&(e.options.$leftSearch=t("#"+e.id+"_leftSearch")),e.options.rightSearch?e.options.$rightSearch=t(e.options.rightSearch):t("#"+e.id+"_rightSearch").length>0&&(e.options.$rightSearch=t("#"+e.id+"_rightSearch")),e.options.leftBulk?e.options.$leftBulk=t(e.options.leftBulk):t("#"+e.id+"_leftBulk").length>0&&(e.options.$leftBulk=t("#"+e.id+"_leftBulk")),e.events()},events:function(){var e=this;e.options.$leftSearch&&e.options.$leftSearch.on("keyup",function(t){e.$left.mfilter(this.value)}),e.options.$rightSearch&&e.options.$rightSearch.on("keyup",function(t){e.$right.mfilter(this.value)}),e.$right.closest("form").on("submit",function(l){e.$left.children().prop("selected",e.options.submitAllLeft),e.$right.children().prop("selected",!1);for(var i=e.right.querySelectorAll("option"),o=[],n=0;n<i.length;n++){var r=i[n].value;r.length>0&&o.push(r)}var c=t('<input type="hidden" name="'+e.$right.attr("name")+'">');c.val(o.join(",")),e.$right.before(c)}),e.$left.on("dblclick","option",function(t){t.preventDefault();var l=e.left.querySelectorAll("option:checked");l.length&&e.moveToRight(l,t)}),e.$right.on("dblclick","option",function(t){t.preventDefault();var l=e.right.querySelectorAll("option:checked");l.length&&e.moveToLeft(l,t)}),(navigator.userAgent.match(/MSIE/i)||navigator.userAgent.indexOf("Trident/")>0||navigator.userAgent.indexOf("Edge/")>0)&&(e.$left.dblclick(function(t){e.actions.$rightSelected.trigger("click")}),e.$right.dblclick(function(t){e.actions.$leftSelected.trigger("click")})),e.actions.$rightSelected.on("click",function(l){l.preventDefault();var i=null;if(e.options.$leftBulk&&e.options.$leftBulk.val().length>0){i=[];var o=e.options.$leftBulk.val(),n=o.split(/\n/).filter(function(t){return t.length>0?t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").toLowerCase():void 0});if(n.length>0)for(var r=e.left.querySelectorAll("option"),c=0;c<r.length;c++)for(var f=r[c].innerHTML.toLowerCase(),a=n.length-1;a>=0;a--)f.indexOf(n[a])>-1&&f.match(new RegExp("([^0-9]|^)"+n[a]+"([^0-9]|$)","g"))&&i.push(r[c]);e.options.$leftBulk.val("")}else i=e.left.querySelectorAll("option:checked");i&&i.length&&e.moveToRight(i,l),t(this).blur()}),e.actions.$leftSelected.on("click",function(l){l.preventDefault();var i=e.right.querySelectorAll("option:checked");i.length&&e.moveToLeft(i,l),t(this).blur()}),e.actions.$rightAll.on("click",function(l){l.preventDefault();var i=e.left.querySelectorAll("option");i.length&&e.moveToRight(i,l),t(this).blur()}),e.actions.$leftAll.on("click",function(l){l.preventDefault();var i=e.right.querySelectorAll("option");i.length&&e.moveToLeft(i,l),t(this).blur()})},moveToRight:function(t,e,l,i){var o=this;if("function"==typeof o.callbacks.moveToRight)return o.callbacks.moveToRight(o,t,e,l,i);if("function"==typeof o.callbacks.beforeMoveToRight&&!l&&!o.callbacks.beforeMoveToRight(o.$left,o.$right,t))return!1;o.options.$rightSearch&&0!==o.options.$rightSearch.val().length&&(o.options.$rightSearch.val(""),o.$right.mfilter(""));for(var n=document.createDocumentFragment(),r=0;r<t.length;r++)n.appendChild(t[r]);return o.right.appendChild(n.cloneNode(!0)),"function"!=typeof o.callbacks.sort||l||o.$right.mSort(o.callbacks.sort),"function"!=typeof o.callbacks.afterMoveToRight||l||o.callbacks.afterMoveToRight(o.$left,o.$right,t),o},moveToLeft:function(t,e,l,i){var o=this;if("function"==typeof o.callbacks.moveToLeft)return o.callbacks.moveToLeft(o,t,e,l,i);if("function"==typeof o.callbacks.beforeMoveToLeft&&!l&&!o.callbacks.beforeMoveToLeft(o.$left,o.$right,t))return!1;o.options.$leftSearch&&0!==o.options.$leftSearch.val().length&&(o.options.$leftSearch.val(""),o.$left.mfilter(""));for(var n=document.createDocumentFragment(),r=0;r<t.length;r++)n.appendChild(t[r]);return o.left.appendChild(n.cloneNode(!0)),"function"!=typeof o.callbacks.sort||l||o.$left.mSort(o.callbacks.sort),"function"!=typeof o.callbacks.afterMoveToLeft||l||o.callbacks.afterMoveToLeft(o.$left,o.$right,t),o}},e}(t);t.multiselect={defaults:{startUp:function(t,e){e.find("option").each(function(e,l){var i=t.find('option[value="'+l.value+'"]');i.parent();i.remove()})},beforeMoveToRight:function(t,e,l){return!0},afterMoveToRight:function(t,e,l){},beforeMoveToLeft:function(t,e,l){return!0},afterMoveToLeft:function(t,e,l){},sort:function(t,e){return"NA"==t.innerHTML?1:"NA"==e.innerHTML?-1:t.innerHTML>e.innerHTML?1:-1}}},t.fn.multiselect=function(l){return this.each(function(){var i=t(this),o=i.data(),n=t.extend({},t.multiselect.defaults,o,l);return new e(i,n)})},t.fn.removeIfEmpty=function(){return this.children().length||this.remove(),this},t.fn.mfilter=function(t){for(var e=document.createDocumentFragment(),l=this.get(0),i=l.querySelectorAll("option"),o=t.toLowerCase(),n=0;n<i.length;n++)if(0===o.length||i[n].innerHTML.toLowerCase().indexOf(o)>-1)e.appendChild(i[n]);else{var r=document.createElement("span");r.appendChild(i[n]),e.appendChild(r)}this.empty(),l.appendChild(e.cloneNode(!0))},t.fn.mSort=function(t){var e=this.get(0),l=Array.prototype.slice.call(e.querySelectorAll("option"),0);l.sort(t);for(var i=document.createDocumentFragment(),o=0;o<l.length;o++)i.appendChild(l[o]);return e.appendChild(i.cloneNode(!0)),this}});
