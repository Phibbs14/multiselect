if("undefined"==typeof jQuery)throw new Error("multiselect requires jQuery");!function(t){"use strict";var e=t.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<7)throw new Error("multiselect crequires jQuery version 1.7 or higher")}(jQuery),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){"use strict";var e=function(t){function e(e,o){var i=e.data();t.extend(o,i);var n=e.prop("id");this.id=n,this.$left=e,this.$right=t(t(o.right).length?o.right:"#"+n+"_to"),this.left=this.$left.get(0),this.right=this.$right.get(0),this.actions={$leftAll:t(t(o.leftAll).length?o.leftAll:"#"+n+"_leftAll"),$rightAll:t(t(o.rightAll).length?o.rightAll:"#"+n+"_rightAll"),$leftSelected:t(t(o.leftSelected).length?o.leftSelected:"#"+n+"_leftSelected"),$rightSelected:t(t(o.rightSelected).length?o.rightSelected:"#"+n+"_rightSelected")},delete o.leftAll,delete o.leftSelected,delete o.right,delete o.rightAll,delete o.rightSelected,this.options={keepRenderingSort:o.keepRenderingSort,submitAllLeft:void 0!==o.submitAllLeft?o.submitAllLeft:!0,submitAllRight:void 0!==o.submitAllRight?o.submitAllRight:!0,leftSearch:o.leftSearch,rightSearch:o.rightSearch,leftBulk:o.leftBulk,stopPropagation:void 0!==o.stopPropagation?o.stopPropagation:!1},delete o.keepRenderingSort,delete o.submitAllLeft,delete o.submitAllRight,delete o.leftSearch,delete o.rightSearch,delete o.leftBulk,delete o.stopPropagation,this.callbacks=o,this.init()}return e.prototype={init:function(){var e=this;e.options.keepRenderingSort&&(e.skipInitSort=!0,e.callbacks.sort=function(e,o){return t(e).data("position")>t(o).data("position")?1:-1},e.$left.find("option").each(function(e,o){t(o).data("position",e)}),e.$right.find("option").each(function(e,o){t(o).data("position",e)})),"function"==typeof e.callbacks.startUp&&e.callbacks.startUp(e.$left,e.$right),e.skipInitSort||"function"!=typeof e.callbacks.sort||e.$left.mSort(e.callbacks.sort),e.options.leftSearch?e.options.$leftSearch=t(e.options.leftSearch):t("#"+e.id+"_leftSearch").length>0&&(e.options.$leftSearch=t("#"+e.id+"_leftSearch")),e.options.rightSearch?e.options.$rightSearch=t(e.options.rightSearch):t("#"+e.id+"_rightSearch").length>0&&(e.options.$rightSearch=t("#"+e.id+"_rightSearch")),e.options.leftBulk?e.options.$leftBulk=t(e.options.leftBulk):t("#"+e.id+"_leftBulk").length>0&&(e.options.$leftBulk=t("#"+e.id+"_leftBulk")),e.events()},events:function(){var e=this;e.options.stopPropagation&&(e.$left.on("change keyup",function(t,e){e||t.stopPropagation()}),e.$right.on("change keyup",function(t,e){e||t.stopPropagation()})),e.options.$leftSearch&&(e.options.$leftSearch.on("keyup",function(t){e.$left.mfilter(this.value)}),e.options.stopPropagation&&e.options.$leftSearch.on("change input keyup",function(t){t.stopPropagation()})),e.options.$rightSearch&&(e.options.$rightSearch.on("keyup",function(t){e.$right.mfilter(this.value)}),e.options.stopPropagation&&e.options.$rightSearch.on("change input keyup",function(t){t.stopPropagation()})),e.options.stopPropagation&&e.options.$leftBulk&&e.options.$leftBulk.on("change input keyup",function(t){t.stopPropagation()}),e.$right.closest("form").on("submit",function(o){e.$left.children().prop("selected",e.options.submitAllLeft),e.$right.children().prop("selected",!1);for(var i=e.right.querySelectorAll("option"),n=[],l=0;l<i.length;l++){var r=i[l].value;r.length>0&&n.push(r)}var c=t('<input type="hidden" name="'+e.$right.attr("name")+'">');c.val(n.join(",")),e.$right.before(c)}),e.$left.on("dblclick","option",function(t){t.preventDefault();var o=e.left.querySelectorAll("option:checked");o.length&&e.moveToRight(o,t)}),e.$right.on("dblclick","option",function(t){t.preventDefault();var o=e.right.querySelectorAll("option:checked");o.length&&e.moveToLeft(o,t)}),(navigator.userAgent.match(/MSIE/i)||navigator.userAgent.indexOf("Trident/")>0||navigator.userAgent.indexOf("Edge/")>0)&&(e.$left.dblclick(function(t){e.actions.$rightSelected.trigger("click")}),e.$right.dblclick(function(t){e.actions.$leftSelected.trigger("click")})),e.actions.$rightSelected.on("click",function(o){o.preventDefault();var i=null;if(e.options.$leftBulk&&e.options.$leftBulk.val().length>0){i=[];var n=e.options.$leftBulk.val(),l=n.split(/\n/).filter(function(t){return t.length>0?t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").toLowerCase():void 0});if(l.length>0)for(var r=e.left.querySelectorAll("option"),c=0;c<r.length;c++)for(var a=r[c].innerHTML.toLowerCase(),f=l.length-1;f>=0;f--)a.indexOf(l[f])>-1&&a.match(new RegExp("([^0-9]|^)0*"+l[f]+"([^0-9]|$)","g"))&&i.push(r[c]);e.options.$leftBulk.val("")}else i=e.left.querySelectorAll("option:checked");i&&i.length&&e.moveToRight(i,o),t(this).blur()}),e.actions.$leftSelected.on("click",function(o){o.preventDefault();var i=e.right.querySelectorAll("option:checked");i.length&&e.moveToLeft(i,o),t(this).blur()}),e.actions.$rightAll.on("click",function(o){o.preventDefault();var i=e.left.querySelectorAll("option");i.length&&e.moveToRight(i,o),t(this).blur()}),e.actions.$leftAll.on("click",function(o){o.preventDefault();var i=e.right.querySelectorAll("option");i.length&&e.moveToLeft(i,o),t(this).blur()})},moveToRight:function(t,e,o,i){var n=this;if("function"==typeof n.callbacks.moveToRight)return n.callbacks.moveToRight(n,t,e,o,i);if("function"==typeof n.callbacks.beforeMoveToRight&&!o&&!n.callbacks.beforeMoveToRight(n.$left,n.$right,t))return!1;n.options.$rightSearch&&0!==n.options.$rightSearch.val().length&&(n.options.$rightSearch.val(""),n.$right.mfilter(""));for(var l=document.createDocumentFragment(),r=0;r<t.length;r++)l.appendChild(t[r]);return n.right.appendChild(l.cloneNode(!0)),"function"!=typeof n.callbacks.sort||o||n.$right.mSort(n.callbacks.sort),"function"!=typeof n.callbacks.afterMoveToRight||o||n.callbacks.afterMoveToRight(n.$left,n.$right,t),n.$right.trigger("change",!0),n},moveToLeft:function(t,e,o,i){var n=this;if("function"==typeof n.callbacks.moveToLeft)return n.callbacks.moveToLeft(n,t,e,o,i);if("function"==typeof n.callbacks.beforeMoveToLeft&&!o&&!n.callbacks.beforeMoveToLeft(n.$left,n.$right,t))return!1;n.options.$leftSearch&&0!==n.options.$leftSearch.val().length&&(n.options.$leftSearch.val(""),n.$left.mfilter(""));for(var l=document.createDocumentFragment(),r=0;r<t.length;r++)l.appendChild(t[r]);return n.left.appendChild(l.cloneNode(!0)),"function"!=typeof n.callbacks.sort||o||n.$left.mSort(n.callbacks.sort),"function"!=typeof n.callbacks.afterMoveToLeft||o||n.callbacks.afterMoveToLeft(n.$left,n.$right,t),n.$left.trigger("change",!0),n}},e}(t);t.multiselect={defaults:{startUp:function(t,e){e.find("option").each(function(e,o){var i=t.find('option[value="'+o.value+'"]');i.parent();i.remove()})},beforeMoveToRight:function(t,e,o){return!0},afterMoveToRight:function(t,e,o){},beforeMoveToLeft:function(t,e,o){return!0},afterMoveToLeft:function(t,e,o){},sort:function(t,e){return"NA"==t.innerHTML?1:"NA"==e.innerHTML?-1:t.innerHTML>e.innerHTML?1:-1}}},t.fn.multiselect=function(o){return this.each(function(){var i=t(this),n=i.data(),l=t.extend({},t.multiselect.defaults,n,o);return new e(i,l)})},t.fn.removeIfEmpty=function(){return this.children().length||this.remove(),this},t.fn.mfilter=function(t){for(var e=document.createDocumentFragment(),o=this.get(0),i=o.querySelectorAll("option"),n=t.toLowerCase(),l=0;l<i.length;l++)if(0===n.length||i[l].innerHTML.toLowerCase().indexOf(n)>-1)e.appendChild(i[l]);else{var r=document.createElement("span");r.appendChild(i[l]),e.appendChild(r)}this.empty(),o.appendChild(e.cloneNode(!0))},t.fn.mSort=function(t){var e=this.get(0),o=Array.prototype.slice.call(e.querySelectorAll("option"),0);o.sort(t);for(var i=document.createDocumentFragment(),n=0;n<o.length;n++)i.appendChild(o[n]);return e.appendChild(i.cloneNode(!0)),this}});
