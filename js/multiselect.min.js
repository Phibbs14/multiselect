if("undefined"==typeof jQuery)throw new Error("multiselect requires jQuery");!function(t){"use strict";var e=t.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<7)throw new Error("multiselect requires jQuery version 1.7 or higher")}(jQuery),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){"use strict";var e=function(t){function e(e,o){var i=e.prop("id");this.$left=e,this.$right=t(t(o.right).length?o.right:"#"+i+"_to"),this.left=this.$left.get(0),this.right=this.$right.get(0),this.actions={$leftAll:t(t(o.leftAll).length?o.leftAll:"#"+i+"_leftAll"),$rightAll:t(t(o.rightAll).length?o.rightAll:"#"+i+"_rightAll"),$leftSelected:t(t(o.leftSelected).length?o.leftSelected:"#"+i+"_leftSelected"),$rightSelected:t(t(o.rightSelected).length?o.rightSelected:"#"+i+"_rightSelected")},delete o.leftAll,delete o.leftSelected,delete o.right,delete o.rightAll,delete o.rightSelected,this.options={keepRenderingSort:o.keepRenderingSort,submitAllLeft:void 0!==o.submitAllLeft?o.submitAllLeft:!0,submitAllRight:void 0!==o.submitAllRight?o.submitAllRight:!0,search:o.search,bulk:o.bulk},delete o.keepRenderingSort,o.submitAllLeft,o.submitAllRight,o.search,this.callbacks=o,this.init()}return e.prototype={init:function(){var e=this;e.options.keepRenderingSort&&(e.skipInitSort=!0,e.callbacks.sort=function(e,o){return t(e).data("position")>t(o).data("position")?1:-1},e.$left.find("option").each(function(e,o){t(o).data("position",e)}),e.$right.find("option").each(function(e,o){t(o).data("position",e)})),"function"==typeof e.callbacks.startUp&&e.callbacks.startUp(e.$left,e.$right),e.skipInitSort||"function"!=typeof e.callbacks.sort||e.$left.mSort(e.callbacks.sort),e.options.search&&e.options.search.left&&(e.options.search.$left=t(e.options.search.left),e.$left.before(e.options.search.$left)),e.options.search&&e.options.search.right&&(e.options.search.$right=t(e.options.search.right),e.$right.before(t(e.options.search.$right))),e.options.bulk&&e.options.bulk.left&&(e.options.bulk.$left=t(e.options.bulk.left),e.$left.parent().append(e.options.bulk.$left)),e.events()},events:function(){var e=this;e.options.search&&e.options.search.$left&&e.options.search.$left.on("keyup",function(t){e.$left.mfilter(this.value)}),e.options.search&&e.options.search.$right&&e.options.search.$right.on("keyup",function(t){e.$right.mfilter(this.value)}),e.$right.closest("form").on("submit",function(o){e.$left.children().prop("selected",e.options.submitAllLeft),e.$right.children().prop("selected",!1);for(var i=e.right.querySelectorAll("option"),l=[],n=0;n<i.length;n++){var r=i[n].value;r.length>0&&l.push(r)}var c=t('<input type="hidden" name="'+e.$right.attr("name")+'">');c.val(l.join(",")),e.$right.before(c)}),e.$left.on("dblclick","option",function(t){t.preventDefault();var o=e.left.querySelectorAll("option:checked");o.length&&e.moveToRight(o,t)}),e.$right.on("dblclick","option",function(t){t.preventDefault();var o=e.right.querySelectorAll("option:checked");o.length&&e.moveToLeft(o,t)}),(navigator.userAgent.match(/MSIE/i)||navigator.userAgent.indexOf("Trident/")>0||navigator.userAgent.indexOf("Edge/")>0)&&(e.$left.dblclick(function(t){e.actions.$rightSelected.trigger("click")}),e.$right.dblclick(function(t){e.actions.$leftSelected.trigger("click")})),e.actions.$rightSelected.on("click",function(o){o.preventDefault();var i=null;if(e.options.bulk&&e.options.bulk.$left&&e.options.bulk.$left.val().length>0){i=[];var l=e.options.bulk.$left.val(),n=l.split(/\n/).filter(function(t){return t.length>0?t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"):void 0});if(n.length>0)for(var r=e.left.querySelectorAll("option"),c=0;c<r.length;c++)for(var f=r[c].innerHTML,a=n.length-1;a>=0;a--)f.match(new RegExp("([^0-9]|^)"+n[a]+"([^0-9]|$)","g"))&&(i.push(r[c]),n.splice(a,1));e.options.bulk.$left.val("")}else i=e.left.querySelectorAll("option:checked");i&&i.length&&e.moveToRight(i,o),t(this).blur()}),e.actions.$leftSelected.on("click",function(o){o.preventDefault();var i=e.right.querySelectorAll("option:checked");i.length&&e.moveToLeft(i,o),t(this).blur()}),e.actions.$rightAll.on("click",function(o){o.preventDefault();var i=e.left.querySelectorAll("option");i.length&&e.moveToRight(i,o),t(this).blur()}),e.actions.$leftAll.on("click",function(o){o.preventDefault();var i=e.right.querySelectorAll("option");i.length&&e.moveToLeft(i,o),t(this).blur()})},moveToRight:function(t,e,o,i){var l=this;if("function"==typeof l.callbacks.moveToRight)return l.callbacks.moveToRight(l,t,e,o,i);if("function"==typeof l.callbacks.beforeMoveToRight&&!o&&!l.callbacks.beforeMoveToRight(l.$left,l.$right,t))return!1;l.options.search&&l.options.search.$right&&0!==l.options.search.$right.val().length&&(l.options.search.$right.val(""),l.$right.mfilter(""));for(var n=document.createDocumentFragment(),r=0;r<t.length;r++)n.appendChild(t[r]);return l.right.appendChild(n.cloneNode(!0)),"function"!=typeof l.callbacks.sort||o||l.$right.mSort(l.callbacks.sort),"function"!=typeof l.callbacks.afterMoveToRight||o||l.callbacks.afterMoveToRight(l.$left,l.$right,t),l},moveToLeft:function(t,e,o,i){var l=this;if("function"==typeof l.callbacks.moveToLeft)return l.callbacks.moveToLeft(l,t,e,o,i);if("function"==typeof l.callbacks.beforeMoveToLeft&&!o&&!l.callbacks.beforeMoveToLeft(l.$left,l.$right,t))return!1;l.options.search&&l.options.search.$left&&0!==l.options.search.$left.val().length&&(l.options.search.$left.val(""),l.$left.mfilter(""));for(var n=document.createDocumentFragment(),r=0;r<t.length;r++)n.appendChild(t[r]);return l.left.appendChild(n.cloneNode(!0)),"function"!=typeof l.callbacks.sort||o||l.$left.mSort(l.callbacks.sort),"function"!=typeof l.callbacks.afterMoveToLeft||o||l.callbacks.afterMoveToLeft(l.$left,l.$right,t),l}},e}(t);t.multiselect={defaults:{startUp:function(t,e){e.find("option").each(function(e,o){var i=t.find('option[value="'+o.value+'"]');i.parent();i.remove()})},beforeMoveToRight:function(t,e,o){return!0},afterMoveToRight:function(t,e,o){},beforeMoveToLeft:function(t,e,o){return!0},afterMoveToLeft:function(t,e,o){},sort:function(t,e){return"NA"==t.innerHTML?1:"NA"==e.innerHTML?-1:t.innerHTML>e.innerHTML?1:-1}}},t.fn.multiselect=function(o){return this.each(function(){var i=t(this),l=i.data(),n=t.extend({},t.multiselect.defaults,l,o);return new e(i,n)})},t.fn.removeIfEmpty=function(){return this.children().length||this.remove(),this},t.fn.mfilter=function(t){for(var e=document.createDocumentFragment(),o=this.get(0),i=o.querySelectorAll("option"),l=t.toLowerCase(),n=0;n<i.length;n++)if(0===l.length||i[n].innerHTML.toLowerCase().indexOf(l)>-1)e.appendChild(i[n]);else{var r=document.createElement("span");r.appendChild(i[n]),e.appendChild(r)}this.empty(),o.appendChild(e.cloneNode(!0))},t.fn.mSort=function(t){var e=this.get(0),o=Array.prototype.slice.call(e.querySelectorAll("option"),0);o.sort(t);for(var i=document.createDocumentFragment(),l=0;l<o.length;l++)i.appendChild(o[l]);return e.appendChild(i.cloneNode(!0)),this}});
